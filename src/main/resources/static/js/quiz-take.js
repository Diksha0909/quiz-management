const api='/api'; let quiz=null, quizId=null; document.addEventListener('DOMContentLoaded',()=>{const p=new URLSearchParams(location.search); quizId=Number(p.get('quizId')); loadQuiz(); document.getElementById('btn-submit').onclick=submitQuiz;});
async function loadQuiz(){const res=await fetch(api+'/public/quizzes/'+quizId); quiz=await res.json(); document.getElementById('quizTitle').textContent='ðŸ§  '+quiz.title; const wrap=document.getElementById('questions'); wrap.innerHTML=''; quiz.questions.forEach(q=>{const card=document.createElement('div'); card.className='card'; card.innerHTML='<b>'+q.text+'</b>'; if(q.type==='MCQ'){const ul=document.createElement('ul'); q.choices.forEach(c=>{const li=document.createElement('li'); li.innerHTML=`<label><input type='radio' name='q${q.id}' value='${c.id}'> ${c.text}</label>`; ul.appendChild(li);}); card.appendChild(ul);} else if(q.type==='TRUE_FALSE'){const d=document.createElement('div'); d.className='row'; d.innerHTML=`<label><input type='radio' name='q${q.id}' value='true'> True</label> <label><input type='radio' name='q${q.id}' value='false'> False</label>`; card.appendChild(d);} else {const inp=document.createElement('input'); inp.id='short-'+q.id; inp.placeholder='Your answer'; inp.style.width='100%'; card.appendChild(inp);} wrap.appendChild(card);});}
async function submitQuiz(){const payload={answers:[]}; quiz.questions.forEach(q=>{ if(q.type==='MCQ'){const sel=document.querySelector(`input[name="q${q.id}"]:checked`); payload.answers.push({questionId:q.id, choiceId: sel? Number(sel.value): null}); } else if(q.type==='TRUE_FALSE'){const sel=document.querySelector(`input[name="q${q.id}"]:checked`); payload.answers.push({questionId:q.id, value: sel? (sel.value==='true'): null}); } else {const txt=document.getElementById('short-'+q.id).value||''; payload.answers.push({questionId:q.id, text: txt}); }});
 const res=await fetch(api+'/public/quizzes/'+quiz.id+'/submit',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}); const result=await res.json(); showResult(result);}
function showResult(result){const div=document.getElementById('result'); div.innerHTML=`<div class='card'><h2>Result: ${result.score} / ${result.total}</h2></div>`; result.feedback.forEach(fb=>{const row=document.createElement('div'); row.className = fb.correct? 'card correct':'card wrong'; row.innerHTML = `<b>${fb.question}</b><br><div><b>Your answer:</b> ${fb.yourAnswer??''}</div><div><b>Correct answer:</b> ${fb.correctAnswer??''}</div>`; div.appendChild(row);});}
